{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"D:\\\\WEB\\\\crypto\\\\client\\\\pages\\\\admin.js\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { Component } from 'react';\nimport _ from \"lodash\";\nimport Layout from \"../components/layout\";\nimport auth from \"../services/authService\";\nimport crypto from \"../services/cryptoService\";\nimport { getUsers, updateAdmin, deleteUser } from \"../services/userService\";\nimport { paginate } from \"../utils/paginate\";\nimport DataTable from \"../components/dataTable\";\nimport Pagination from \"../components/pagination\";\nimport loading from \"../src/91.gif\";\nimport cryptoImg from \"../src/crypto-text.png\";\n\nvar Admin =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Admin, _Component);\n\n  function Admin() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Admin);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Admin)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      user: {},\n      data: [],\n      pageSize: 7,\n      currentPage: 1,\n      searchQuery: \"\",\n      sortColumn: {\n        path: \"email\",\n        order: \"asc\"\n      },\n      columns: [{\n        path: \"email\",\n        label: \"Email\"\n      }, {\n        path: \"name\",\n        label: \"Name\"\n      }, {\n        key: \"isAdmin\",\n        label: \"Admin\",\n        content: function content(data) {\n          return __jsx(\"select\", {\n            name: \"isAdmin\",\n            className: \"form-control select-w\",\n            onChange: function onChange(e) {\n              return _this.handleChangeBool(e, data);\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 29\n            },\n            __self: this\n          }, __jsx(\"option\", {\n            value: data.isAdmin,\n            hidden: true,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 30\n            },\n            __self: this\n          }, data.isAdmin), __jsx(\"option\", {\n            value: true,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 31\n            },\n            __self: this\n          }, \"true\"), __jsx(\"option\", {\n            value: false,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 32\n            },\n            __self: this\n          }, \"false\"));\n        }\n      }, {\n        key: \"update\",\n        content: function content(data) {\n          return __jsx(\"button\", {\n            onClick: function onClick() {\n              return _this.doUpdate(data);\n            },\n            className: \"btn btn-warning btn-sm\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 35\n            },\n            __self: this\n          }, \"Update\");\n        }\n      }, {\n        key: \"delete\",\n        content: function content(data) {\n          return __jsx(\"button\", {\n            onClick: function onClick() {\n              return _this.handleDelete(data);\n            },\n            className: \"btn btn-danger btn-sm\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 36\n            },\n            __self: this\n          }, \"Delete\");\n        }\n      }],\n      disabled: false,\n      loaded: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getData\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return getUsers().then(function (res) {\n                console.log(res.data);\n\n                var data = _toConsumableArray(res.data);\n\n                data.map(function (item) {\n                  return item.isAdmin = item.isAdmin.toString();\n                });\n\n                _this.setState({\n                  data: data,\n                  loaded: true\n                });\n              });\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"handlePageChange\", function (page) {\n      _this.setState({\n        currentPage: page\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSearch\", function (query) {\n      _this.setState({\n        searchQuery: query.target.value,\n        currentPage: 1\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSort\", function (sortColumn) {\n      _this.setState({\n        sortColumn: sortColumn\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleDelete\",\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(data) {\n        var originalData, allData;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                originalData = _toConsumableArray(_this.state.data);\n                allData = originalData.filter(function (m) {\n                  return m._id !== data._id;\n                });\n\n                _this.setState({\n                  data: allData\n                });\n\n                _context2.prev = 3;\n                _context2.next = 6;\n                return deleteUser(data._id);\n\n              case 6:\n                _context2.next = 8;\n                return _this.getData();\n\n              case 8:\n                _context2.next = 14;\n                break;\n\n              case 10:\n                _context2.prev = 10;\n                _context2.t0 = _context2[\"catch\"](3);\n                if (_context2.t0.response && _context2.t0.response.status === 404) console.log(\"This user was already deleted.\");\n\n                _this.setState({\n                  data: originalData\n                });\n\n              case 14:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[3, 10]]);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"handleChangeBool\", function (e, data) {\n      data[e.target.name] = e.target.value;\n\n      var allData = _objectSpread({}, _this.state.data);\n\n      for (var i = 0; i < allData.length; i++) {\n        if (allData[i]._id === data._id) allData[i] = data;\n      }\n\n      allData = _Object$keys(allData).map(function (key) {\n        return allData[key];\n      });\n\n      _this.setState({\n        data: allData\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"doUpdate\",\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(data) {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                delete data.__v;\n                data.isAdmin = JSON.parse(data.isAdmin);\n                _context3.next = 5;\n                return updateAdmin(data);\n\n              case 5:\n                _context3.next = 10;\n                break;\n\n              case 7:\n                _context3.prev = 7;\n                _context3.t0 = _context3[\"catch\"](0);\n\n                if (_context3.t0.response && _context3.t0.response.status === 400) {\n                  console.log(\"Incorrectly data entered!\");\n                }\n\n              case 10:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[0, 7]]);\n      }));\n\n      return function (_x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"getPageData\", function () {\n      var _this$state = _this.state,\n          pageSize = _this$state.pageSize,\n          currentPage = _this$state.currentPage,\n          allData = _this$state.data,\n          searchQuery = _this$state.searchQuery,\n          sortColumn = _this$state.sortColumn;\n      var filtered = allData;\n      if (searchQuery) filtered = allData.filter(function (m) {\n        return m.email.toLowerCase().startsWith(searchQuery.toLowerCase());\n      });\n\n      var sorted = _.orderBy(filtered, [sortColumn.path], [sortColumn.order]);\n\n      var data = paginate(sorted, currentPage, pageSize);\n      return {\n        totalCount: filtered.length,\n        data: data\n      };\n    });\n\n    return _this;\n  }\n\n  _createClass(Admin, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4() {\n        var user;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                user = auth.getCurrentUser();\n                this.setState({\n                  user: user\n                });\n                _context4.next = 4;\n                return this.getData();\n\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (process.browser && !auth.getCurrentUser()) {\n        window.location.replace(\"/login\");\n      } else {\n        if (process.browser && this.state.user.isAdmin === false) {\n          window.location.replace(\"/index\");\n        }\n\n        var _this$state2 = this.state,\n            pageSize = _this$state2.pageSize,\n            currentPage = _this$state2.currentPage,\n            searchQuery = _this$state2.searchQuery,\n            sortColumn = _this$state2.sortColumn;\n\n        var _this$getPageData = this.getPageData(),\n            totalCount = _this$getPageData.totalCount,\n            data = _this$getPageData.data;\n\n        return __jsx(Layout, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 130\n          },\n          __self: this\n        }, __jsx(\"div\", {\n          className: \"w-50 mx-auto text-center pt-5\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 131\n          },\n          __self: this\n        }, __jsx(\"img\", {\n          src: cryptoImg,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 132\n          },\n          __self: this\n        }), __jsx(\"h1\", {\n          style: {\n            fontFamily: \"Courier New\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 133\n          },\n          __self: this\n        }, __jsx(\"strong\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 133\n          },\n          __self: this\n        }, \"Administration panel\")), __jsx(\"hr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 134\n          },\n          __self: this\n        })), this.state.loaded ? __jsx(\"div\", {\n          className: \"text-center pt-2\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 137\n          },\n          __self: this\n        }, __jsx(\"div\", {\n          className: \"row mx-auto\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 138\n          },\n          __self: this\n        }, __jsx(\"div\", {\n          className: \"col-md-12 mt-5\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 139\n          },\n          __self: this\n        }, __jsx(\"input\", {\n          type: \"text\",\n          onChange: this.handleSearch,\n          placeholder: \"Search Users...\",\n          value: this.state.searchQuery,\n          name: \"searchQueryCryptocurrencies\",\n          className: \"form-control shadow w-25\",\n          style: {\n            display: \"inline-block\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 140\n          },\n          __self: this\n        }), __jsx(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 141\n          },\n          __self: this\n        }, \"   \", __jsx(\"i\", {\n          className: \"fas fa-search\",\n          style: {\n            display: \"inline-block\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 141\n          },\n          __self: this\n        }))), __jsx(\"div\", {\n          className: \"col-md-12 mt-3\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 143\n          },\n          __self: this\n        }, !_.isEmpty(this.state.data) ? __jsx(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 144\n          },\n          __self: this\n        }, __jsx(DataTable, {\n          data: data,\n          sortColumn: sortColumn,\n          onDelete: this.handleDelete,\n          onSort: this.handleSort,\n          columns: this.state.columns,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 145\n          },\n          __self: this\n        })) : __jsx(\"img\", {\n          src: loading,\n          alt: \"loading\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 151\n          },\n          __self: this\n        }), __jsx(Pagination, {\n          itemsCount: totalCount,\n          pageSize: pageSize,\n          currentPage: currentPage,\n          onPageChange: this.handlePageChange,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 152\n          },\n          __self: this\n        })))) : __jsx(\"div\", {\n          className: \"w-50 mx-auto text-center\",\n          style: {\n            paddingTop: \"30vh\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 160\n          },\n          __self: this\n        }, __jsx(\"img\", {\n          src: loading,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 160\n          },\n          __self: this\n        })));\n      }\n    }\n  }]);\n\n  return Admin;\n}(Component);\n\nexport { Admin as default };","map":{"version":3,"sources":["D:/WEB/crypto/client/pages/admin.js"],"names":["React","Component","_","Layout","auth","crypto","getUsers","updateAdmin","deleteUser","paginate","DataTable","Pagination","loading","cryptoImg","Admin","user","data","pageSize","currentPage","searchQuery","sortColumn","path","order","columns","label","key","content","e","handleChangeBool","isAdmin","doUpdate","handleDelete","disabled","loaded","then","res","console","log","map","item","toString","setState","page","query","target","value","originalData","state","allData","filter","m","_id","getData","response","status","name","i","length","__v","JSON","parse","filtered","email","toLowerCase","startsWith","sorted","orderBy","totalCount","getCurrentUser","process","browser","window","location","replace","getPageData","fontFamily","handleSearch","display","isEmpty","handleSort","handlePageChange","paddingTop"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport _ from \"lodash\";\r\n\r\nimport Layout from \"../components/layout\";\r\nimport auth from \"../services/authService\";\r\nimport crypto from \"../services/cryptoService\";\r\nimport {getUsers, updateAdmin, deleteUser} from \"../services/userService\";\r\nimport {paginate} from \"../utils/paginate\";\r\nimport DataTable from \"../components/dataTable\";\r\nimport Pagination from \"../components/pagination\";\r\nimport loading from \"../src/91.gif\";\r\nimport cryptoImg from \"../src/crypto-text.png\";\r\n\r\nexport default class Admin extends Component{\r\n    state = {\r\n        user: {},\r\n        data: [],\r\n\t\tpageSize: 7,\r\n\t\tcurrentPage: 1,\r\n\t\tsearchQuery: \"\",\r\n\t\tsortColumn: {\r\n\t\t\tpath: \"email\",\r\n\t\t\torder: \"asc\"\r\n\t\t},\r\n\t\tcolumns: [\r\n            {path: \"email\", label: \"Email\"},\r\n            {path: \"name\", label: \"Name\"},\r\n\t\t\t{key: \"isAdmin\", label:\"Admin\", content: data => (\r\n\t\t\t\t\t<select name=\"isAdmin\" className=\"form-control select-w\" onChange={(e) => this.handleChangeBool(e,data)}>\r\n\t\t\t\t\t\t<option value={data.isAdmin} hidden>{data.isAdmin}</option>\r\n\t\t\t\t\t\t<option value={true}>true</option>\r\n\t\t\t\t\t\t<option value={false}>false</option>\r\n\t\t\t\t\t</select>\r\n\t\t\t\t)},\r\n\t\t\t{key: \"update\", content: data => ( <button onClick={() => this.doUpdate(data)} className=\"btn btn-warning btn-sm\">Update</button>)},\r\n\t\t\t{key: \"delete\", content: data => ( <button onClick={() => this.handleDelete(data)} className=\"btn btn-danger btn-sm\">Delete</button>)}\r\n\t\t],\r\n        disabled: false,\r\n        loaded: false\r\n    }\r\n\r\n    getData = async () => {\r\n        await getUsers().then(res => {\r\n\t\t\tconsole.log(res.data);\r\n\t\t\tconst data = [...res.data];\r\n\t\t\tdata.map(item => item.isAdmin = item.isAdmin.toString());\r\n\t\t\tthis.setState({data, loaded: true});\r\n\t\t});\r\n    }\r\n\r\n    async componentDidMount() {\r\n\t\tconst user = auth.getCurrentUser();\r\n        this.setState({user});\r\n        await this.getData();\r\n    }\r\n\r\n    handlePageChange = page => {\r\n\t\tthis.setState({currentPage:page});\r\n\t};\r\n\r\n\thandleSearch = query => {\r\n\t\tthis.setState({searchQuery: query.target.value, currentPage: 1});\r\n\t};\r\n\r\n\thandleSort = sortColumn => {\r\n\t\tthis.setState({sortColumn});\r\n    };\r\n    \r\n    handleDelete = async data => {\r\n\t\tconst originalData = [...this.state.data];\r\n\t\tconst allData = originalData.filter(m => m._id !== data._id);\r\n\t\tthis.setState({data:allData});\r\n\t\ttry {\r\n\t\t\tawait deleteUser(data._id);\r\n\t\t\tawait this.getData();\r\n\t\t}\r\n\t\tcatch(ex){\r\n\t\t\tif(ex.response && ex.response.status === 404) console.log(\"This user was already deleted.\");\r\n\r\n\t\t\tthis.setState({data: originalData});\r\n\t\t}\r\n\t};\r\n\r\n    handleChangeBool = (e,data) => {\r\n\t\tdata[e.target.name] = e.target.value;\r\n\t\tlet allData = {...this.state.data};\r\n\t\tfor(let i=0; i<allData.length; i++) if(allData[i]._id === data._id) allData[i] = data;\r\n\t\tallData = Object.keys(allData).map(key => allData[key]);\r\n\t\tthis.setState({data: allData});\r\n\t};\r\n    \r\n    doUpdate = async data => {\r\n\t\ttry{\r\n            delete data.__v;\r\n\t\t\tdata.isAdmin = JSON.parse(data.isAdmin);\r\n            await updateAdmin(data);\r\n\t\t}\r\n\t\tcatch(ex){\r\n\t\t\tif(ex.response && ex.response.status === 400){\r\n\t\t\t\tconsole.log(\"Incorrectly data entered!\");\r\n\t\t\t}\r\n\t\t}\r\n    };\r\n    \r\n    getPageData = () => {\r\n\t\tconst { pageSize, currentPage, data: allData, searchQuery, sortColumn } = this.state;\r\n\r\n\t\tlet filtered = allData;\r\n\t\tif(searchQuery) filtered = allData.filter(m => m.email.toLowerCase().startsWith(searchQuery.toLowerCase()));\r\n\r\n\t\tconst sorted = _.orderBy(filtered, [sortColumn.path], [sortColumn.order]);\r\n\r\n\t\tconst data = paginate(sorted, currentPage, pageSize);\r\n\r\n\t\treturn {totalCount: filtered.length, data: data};\r\n\t};\r\n\r\n    render(){\r\n        if(process.browser && !auth.getCurrentUser()) {\r\n            window.location.replace(\"/login\");\r\n        }\r\n        else {\r\n            if(process.browser && this.state.user.isAdmin === false) {\r\n                window.location.replace(\"/index\");\r\n            }\r\n            const { pageSize, currentPage, searchQuery, sortColumn } = this.state;\r\n            const {totalCount, data} = this.getPageData();\r\n        \r\n            return (\r\n                <Layout>\r\n                    <div className=\"w-50 mx-auto text-center pt-5\">\r\n                        <img src={cryptoImg} />\r\n                        <h1 style={{fontFamily: \"Courier New\"}}><strong>Administration panel</strong></h1>\r\n                        <hr/>\r\n\t\t\t\t    </div>\r\n                    {this.state.loaded ?\r\n\t\t\t\t\t<div className=\"text-center pt-2\">\r\n\t\t\t\t\t\t<div className=\"row mx-auto\">\r\n                            <div className=\"col-md-12 mt-5\">\r\n                                <input type=\"text\" onChange={this.handleSearch} placeholder=\"Search Users...\" value={this.state.searchQuery} name=\"searchQueryCryptocurrencies\" className=\"form-control shadow w-25\" style={{display: \"inline-block\"}}/>\r\n                                <span>   <i className=\"fas fa-search\" style={{display: \"inline-block\"}}/></span>\r\n                            </div>\r\n                            <div className=\"col-md-12 mt-3\">\r\n                                {!_.isEmpty(this.state.data) ? <div>\r\n                                    <DataTable\r\n                                        data={data}\r\n                                        sortColumn={sortColumn}\r\n                                        onDelete={this.handleDelete}\r\n                                        onSort={this.handleSort}\r\n                                        columns={this.state.columns}\r\n                                    /></div>: <img src={loading} alt=\"loading\"/>}\r\n                                <Pagination\r\n                                    itemsCount={totalCount}\r\n                                    pageSize={pageSize}\r\n                                    currentPage={currentPage}\r\n                                    onPageChange={this.handlePageChange}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div> : <div className=\"w-50 mx-auto text-center\" style={{paddingTop: \"30vh\"}}><img src={loading} /></div>}\r\n                </Layout>\r\n            );\r\n        }\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}