{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"D:\\\\WEB\\\\crypto\\\\client\\\\pages\\\\admin.js\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { Component } from 'react';\nimport _ from \"lodash\";\nimport Layout from \"../components/layout\";\nimport auth from \"../services/authService\";\nimport crypto from \"../services/cryptoService\";\nimport { getUsers, update, deleteUser } from \"../services/userService\";\nimport { paginate } from \"../utils/paginate\";\nimport DataTable from \"../components/dataTable\";\nimport Pagination from \"../components/pagination\";\nexport default class Admin extends Component {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      user: {},\n      data: [],\n      pageSize: 7,\n      currentPage: 1,\n      searchQuery: \"\",\n      sortColumn: {\n        path: \"email\",\n        order: \"asc\"\n      },\n      columns: [{\n        path: \"email\",\n        label: \"Email\"\n      }, {\n        path: \"name\",\n        label: \"Name\"\n      }, {\n        key: \"isAdmin\",\n        label: \"Admin\",\n        content: data => __jsx(\"select\", {\n          name: \"isAdmin\",\n          className: \"form-control select-w\",\n          onChange: e => this.handleChangeBool(e, data),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 27\n          },\n          __self: this\n        }, __jsx(\"option\", {\n          value: data.isAdmin,\n          hidden: true,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 28\n          },\n          __self: this\n        }, data.isAdmin), __jsx(\"option\", {\n          value: true,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 29\n          },\n          __self: this\n        }, \"true\"), __jsx(\"option\", {\n          value: false,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 30\n          },\n          __self: this\n        }, \"false\"))\n      }, {\n        key: \"update\",\n        content: data => __jsx(\"button\", {\n          onClick: () => this.doUpdate(data),\n          className: \"btn btn-warning btn-sm\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 33\n          },\n          __self: this\n        }, \"Update\")\n      }, {\n        key: \"delete\",\n        content: data => __jsx(\"button\", {\n          onClick: () => this.handleDelete(data),\n          className: \"btn btn-danger btn-sm\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 34\n          },\n          __self: this\n        }, \"Delete\")\n      }],\n      disabled: false\n    });\n\n    _defineProperty(this, \"getData\", async () => {\n      await getUsers().then(res => {\n        console.log(res.data);\n        const data = [...res.data];\n        data.map(item => item.isAdmin = item.isAdmin.toString());\n        this.setState({\n          data\n        });\n      });\n    });\n\n    _defineProperty(this, \"handlePageChange\", page => {\n      this.setState({\n        currentPage: page\n      });\n    });\n\n    _defineProperty(this, \"handleSearch\", query => {\n      this.setState({\n        searchQuery: query.target.value,\n        currentPage: 1\n      });\n    });\n\n    _defineProperty(this, \"handleSort\", sortColumn => {\n      this.setState({\n        sortColumn\n      });\n    });\n\n    _defineProperty(this, \"handleDelete\", async data => {\n      const originalData = [...this.state.data];\n      const allData = originalData.filter(m => m._id !== data._id);\n      this.setState({\n        data: allData\n      });\n\n      try {\n        await deleteUser(data._id);\n        await this.getData();\n      } catch (ex) {\n        if (ex.response && ex.response.status === 404) console.log(\"This user was already deleted.\");\n        this.setState({\n          data: originalData\n        });\n      }\n    });\n\n    _defineProperty(this, \"handleChangeBool\", (e, data) => {\n      data[e.target.name] = e.target.value;\n\n      let allData = _objectSpread({}, this.state.data);\n\n      for (let i = 0; i < allData.length; i++) if (allData[i]._id === data._id) allData[i] = data;\n\n      allData = _Object$keys(allData).map(key => allData[key]);\n      this.setState({\n        data: allData\n      });\n    });\n\n    _defineProperty(this, \"doUpdate\", async data => {\n      try {\n        delete data.__v;\n        delete data.email;\n        data.isAdmin = JSON.parse(data.isAdmin);\n        await update(data);\n      } catch (ex) {\n        if (ex.response && ex.response.status === 400) {\n          console.log(\"Incorrectly data entered!\");\n        }\n      }\n    });\n\n    _defineProperty(this, \"getPageData\", () => {\n      const {\n        pageSize,\n        currentPage,\n        data: allData,\n        searchQuery,\n        sortColumn\n      } = this.state;\n      console.log(searchQuery);\n      let filtered = allData;\n      if (searchQuery) filtered = allData.filter(m => m.email.toLowerCase().startsWith(searchQuery.toLowerCase()));\n\n      const sorted = _.orderBy(filtered, [sortColumn.path], [sortColumn.order]);\n\n      const data = paginate(sorted, currentPage, pageSize);\n      return {\n        totalCount: filtered.length,\n        data: data\n      };\n    });\n  }\n\n  async componentDidMount() {\n    const user = auth.getCurrentUser();\n    this.setState({\n      user\n    });\n    await this.getData();\n  }\n\n  render() {\n    if (process.browser && !auth.getCurrentUser()) {\n      window.location.replace(\"/login\");\n    } else {\n      const {\n        pageSize,\n        currentPage,\n        searchQuery,\n        sortColumn\n      } = this.state;\n      const {\n        totalCount,\n        data\n      } = this.getPageData();\n      return __jsx(Layout, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 126\n        },\n        __self: this\n      }, __jsx(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 127\n        },\n        __self: this\n      }, \"Hello \", this.state.user.name, \"! ADMINNDWIA\"), __jsx(\"div\", {\n        className: \"row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 128\n        },\n        __self: this\n      }, __jsx(\"div\", {\n        className: \"col-md-3\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129\n        },\n        __self: this\n      }, __jsx(\"input\", {\n        type: \"text\",\n        onChange: this.handleSearch,\n        placeholder: \"Search Users...\",\n        value: this.state.searchQuery,\n        name: \"searchQueryCryptocurrencies\",\n        className: \"form-control shadow\",\n        style: {\n          display: \"inline-block\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130\n        },\n        __self: this\n      }), __jsx(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      }, \"   \", __jsx(\"i\", {\n        className: \"fas fa-search\",\n        style: {\n          display: \"inline-block\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      }))), __jsx(\"div\", {\n        className: \"col-md-9\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133\n        },\n        __self: this\n      }, !_.isEmpty(this.state.data) ? __jsx(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134\n        },\n        __self: this\n      }, __jsx(DataTable, {\n        data: data,\n        sortColumn: sortColumn,\n        onDelete: this.handleDelete,\n        onSort: this.handleSort,\n        columns: this.state.columns,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135\n        },\n        __self: this\n      })) : __jsx(\"img\", {\n        src: require(\"../src/91.gif\"),\n        alt: \"loading\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141\n        },\n        __self: this\n      }), __jsx(Pagination, {\n        itemsCount: totalCount,\n        pageSize: pageSize,\n        currentPage: currentPage,\n        onPageChange: this.handlePageChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142\n        },\n        __self: this\n      }))));\n    }\n  }\n\n}","map":{"version":3,"sources":["D:/WEB/crypto/client/pages/admin.js"],"names":["React","Component","_","Layout","auth","crypto","getUsers","update","deleteUser","paginate","DataTable","Pagination","Admin","user","data","pageSize","currentPage","searchQuery","sortColumn","path","order","columns","label","key","content","e","handleChangeBool","isAdmin","doUpdate","handleDelete","disabled","then","res","console","log","map","item","toString","setState","page","query","target","value","originalData","state","allData","filter","m","_id","getData","ex","response","status","name","i","length","__v","email","JSON","parse","filtered","toLowerCase","startsWith","sorted","orderBy","totalCount","componentDidMount","getCurrentUser","render","process","browser","window","location","replace","getPageData","handleSearch","display","isEmpty","handleSort","require","handlePageChange"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport _ from \"lodash\";\r\n\r\nimport Layout from \"../components/layout\";\r\nimport auth from \"../services/authService\";\r\nimport crypto from \"../services/cryptoService\";\r\nimport {getUsers, update, deleteUser} from \"../services/userService\";\r\nimport {paginate} from \"../utils/paginate\";\r\nimport DataTable from \"../components/dataTable\";\r\nimport Pagination from \"../components/pagination\";\r\n\r\nexport default class Admin extends Component{\r\n    state = {\r\n        user: {},\r\n        data: [],\r\n\t\tpageSize: 7,\r\n\t\tcurrentPage: 1,\r\n\t\tsearchQuery: \"\",\r\n\t\tsortColumn: {\r\n\t\t\tpath: \"email\",\r\n\t\t\torder: \"asc\"\r\n\t\t},\r\n\t\tcolumns: [\r\n            {path: \"email\", label: \"Email\"},\r\n            {path: \"name\", label: \"Name\"},\r\n\t\t\t{key: \"isAdmin\", label:\"Admin\", content: data => (\r\n\t\t\t\t\t<select name=\"isAdmin\" className=\"form-control select-w\" onChange={(e) => this.handleChangeBool(e,data)}>\r\n\t\t\t\t\t\t<option value={data.isAdmin} hidden>{data.isAdmin}</option>\r\n\t\t\t\t\t\t<option value={true}>true</option>\r\n\t\t\t\t\t\t<option value={false}>false</option>\r\n\t\t\t\t\t</select>\r\n\t\t\t\t)},\r\n\t\t\t{key: \"update\", content: data => ( <button onClick={() => this.doUpdate(data)} className=\"btn btn-warning btn-sm\">Update</button>)},\r\n\t\t\t{key: \"delete\", content: data => ( <button onClick={() => this.handleDelete(data)} className=\"btn btn-danger btn-sm\">Delete</button>)}\r\n\t\t],\r\n\t\tdisabled: false\r\n    }\r\n\r\n    getData = async () => {\r\n        await getUsers().then(res => {\r\n\t\t\tconsole.log(res.data);\r\n\t\t\tconst data = [...res.data];\r\n\t\t\tdata.map(item => item.isAdmin = item.isAdmin.toString());\r\n\t\t\tthis.setState({data});\r\n\t\t});\r\n    }\r\n\r\n    async componentDidMount() {\r\n\t\tconst user = auth.getCurrentUser();\r\n        this.setState({user});\r\n        await this.getData();\r\n    }\r\n\r\n    handlePageChange = page => {\r\n\t\tthis.setState({currentPage:page});\r\n\t};\r\n\r\n\thandleSearch = query => {\r\n\t\tthis.setState({searchQuery: query.target.value, currentPage: 1});\r\n\t};\r\n\r\n\thandleSort = sortColumn => {\r\n\t\tthis.setState({sortColumn});\r\n    };\r\n    \r\n    handleDelete = async data => {\r\n\t\tconst originalData = [...this.state.data];\r\n\t\tconst allData = originalData.filter(m => m._id !== data._id);\r\n\t\tthis.setState({data:allData});\r\n\t\ttry {\r\n\t\t\tawait deleteUser(data._id);\r\n\t\t\tawait this.getData();\r\n\t\t}\r\n\t\tcatch(ex){\r\n\t\t\tif(ex.response && ex.response.status === 404) console.log(\"This user was already deleted.\");\r\n\r\n\t\t\tthis.setState({data: originalData});\r\n\t\t}\r\n\t};\r\n\r\n    handleChangeBool = (e,data) => {\r\n\t\tdata[e.target.name] = e.target.value;\r\n\t\tlet allData = {...this.state.data};\r\n\t\tfor(let i=0; i<allData.length; i++) if(allData[i]._id === data._id) allData[i] = data;\r\n\t\tallData = Object.keys(allData).map(key => allData[key]);\r\n\t\tthis.setState({data: allData});\r\n\t};\r\n    \r\n    doUpdate = async data => {\r\n\t\ttry{\r\n\t\t\tdelete data.__v;\r\n\t\t\tdelete data.email;\r\n\t\t\tdata.isAdmin = JSON.parse(data.isAdmin);\r\n\t\t\tawait update(data);\r\n\t\t}\r\n\t\tcatch(ex){\r\n\t\t\tif(ex.response && ex.response.status === 400){\r\n\t\t\t\tconsole.log(\"Incorrectly data entered!\");\r\n\t\t\t}\r\n\t\t}\r\n    };\r\n    \r\n    getPageData = () => {\r\n\t\tconst { pageSize, currentPage, data: allData, searchQuery, sortColumn } = this.state;\r\n\r\n        console.log(searchQuery);\r\n\t\tlet filtered = allData;\r\n\t\tif(searchQuery) filtered = allData.filter(m => m.email.toLowerCase().startsWith(searchQuery.toLowerCase()));\r\n\r\n\t\tconst sorted = _.orderBy(filtered, [sortColumn.path], [sortColumn.order]);\r\n\r\n\t\tconst data = paginate(sorted, currentPage, pageSize);\r\n\r\n\t\treturn {totalCount: filtered.length, data: data};\r\n\t};\r\n\r\n    render(){\r\n        if(process.browser && !auth.getCurrentUser()) {\r\n            window.location.replace(\"/login\");\r\n        }\r\n        else {\r\n            const { pageSize, currentPage, searchQuery, sortColumn } = this.state;\r\n            const {totalCount, data} = this.getPageData();\r\n        \r\n            return (\r\n                <Layout>\r\n                    <p>Hello {this.state.user.name}! ADMINNDWIA</p>\r\n                    <div className=\"row\">\r\n                        <div className=\"col-md-3\">\r\n                            <input type=\"text\" onChange={this.handleSearch} placeholder=\"Search Users...\" value={this.state.searchQuery} name=\"searchQueryCryptocurrencies\" className=\"form-control shadow\" style={{display: \"inline-block\"}}/>\r\n                            <span>   <i className=\"fas fa-search\" style={{display: \"inline-block\"}}/></span>\r\n                        </div>\r\n                        <div className=\"col-md-9\">\r\n\t\t\t\t\t\t{!_.isEmpty(this.state.data) ? <div>\r\n\t\t\t\t\t\t\t<DataTable\r\n\t\t\t\t\t\t\t\tdata={data}\r\n\t\t\t\t\t\t\t\tsortColumn={sortColumn}\r\n\t\t\t\t\t\t\t\tonDelete={this.handleDelete}\r\n\t\t\t\t\t\t\t\tonSort={this.handleSort}\r\n\t\t\t\t\t\t\t\tcolumns={this.state.columns}\r\n\t\t\t\t\t\t\t/></div>: <img src={require(\"../src/91.gif\")} alt=\"loading\"/>}\r\n\t\t\t\t\t\t<Pagination\r\n\t\t\t\t\t\t\titemsCount={totalCount}\r\n\t\t\t\t\t\t\tpageSize={pageSize}\r\n\t\t\t\t\t\t\tcurrentPage={currentPage}\r\n\t\t\t\t\t\t\tonPageChange={this.handlePageChange}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n                    </div>\r\n                </Layout>\r\n            );\r\n        }\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}