{"version":3,"file":"static/webpack/static\\development\\pages\\admin.js.7338a3bf30cddf0ebc7b.hot-update.js","sources":["webpack:///./pages/admin.js"],"sourcesContent":["import React, { Component } from 'react';\r\nimport _ from \"lodash\";\r\n\r\nimport Layout from \"../components/layout\";\r\nimport auth from \"../services/authService\";\r\nimport crypto from \"../services/cryptoService\";\r\nimport {getUsers, updateAdmin, deleteUser} from \"../services/userService\";\r\nimport {paginate} from \"../utils/paginate\";\r\nimport DataTable from \"../components/dataTable\";\r\nimport Pagination from \"../components/pagination\";\r\n\r\nexport default class Admin extends Component{\r\n    state = {\r\n        user: {},\r\n        data: [],\r\n\t\tpageSize: 7,\r\n\t\tcurrentPage: 1,\r\n\t\tsearchQuery: \"\",\r\n\t\tsortColumn: {\r\n\t\t\tpath: \"email\",\r\n\t\t\torder: \"asc\"\r\n\t\t},\r\n\t\tcolumns: [\r\n            {path: \"email\", label: \"Email\"},\r\n            {path: \"name\", label: \"Name\"},\r\n\t\t\t{key: \"isAdmin\", label:\"Admin\", content: data => (\r\n\t\t\t\t\t<select name=\"isAdmin\" className=\"form-control select-w\" onChange={(e) => this.handleChangeBool(e,data)}>\r\n\t\t\t\t\t\t<option value={data.isAdmin} hidden>{data.isAdmin}</option>\r\n\t\t\t\t\t\t<option value={true}>true</option>\r\n\t\t\t\t\t\t<option value={false}>false</option>\r\n\t\t\t\t\t</select>\r\n\t\t\t\t)},\r\n\t\t\t{key: \"update\", content: data => ( <button onClick={() => this.doUpdate(data)} className=\"btn btn-warning btn-sm\">Update</button>)},\r\n\t\t\t{key: \"delete\", content: data => ( <button onClick={() => this.handleDelete(data)} className=\"btn btn-danger btn-sm\">Delete</button>)}\r\n\t\t],\r\n\t\tdisabled: false\r\n    }\r\n\r\n    getData = async () => {\r\n        await getUsers().then(res => {\r\n\t\t\tconsole.log(res.data);\r\n\t\t\tconst data = [...res.data];\r\n\t\t\tdata.map(item => item.isAdmin = item.isAdmin.toString());\r\n\t\t\tthis.setState({data});\r\n\t\t});\r\n    }\r\n\r\n    async componentDidMount() {\r\n\t\tconst user = auth.getCurrentUser();\r\n        this.setState({user});\r\n        await this.getData();\r\n    }\r\n\r\n    handlePageChange = page => {\r\n\t\tthis.setState({currentPage:page});\r\n\t};\r\n\r\n\thandleSearch = query => {\r\n\t\tthis.setState({searchQuery: query.target.value, currentPage: 1});\r\n\t};\r\n\r\n\thandleSort = sortColumn => {\r\n\t\tthis.setState({sortColumn});\r\n    };\r\n    \r\n    handleDelete = async data => {\r\n\t\tconst originalData = [...this.state.data];\r\n\t\tconst allData = originalData.filter(m => m._id !== data._id);\r\n\t\tthis.setState({data:allData});\r\n\t\ttry {\r\n\t\t\tawait deleteUser(data._id);\r\n\t\t\tawait this.getData();\r\n\t\t}\r\n\t\tcatch(ex){\r\n\t\t\tif(ex.response && ex.response.status === 404) console.log(\"This user was already deleted.\");\r\n\r\n\t\t\tthis.setState({data: originalData});\r\n\t\t}\r\n\t};\r\n\r\n    handleChangeBool = (e,data) => {\r\n\t\tdata[e.target.name] = e.target.value;\r\n\t\tlet allData = {...this.state.data};\r\n\t\tfor(let i=0; i<allData.length; i++) if(allData[i]._id === data._id) allData[i] = data;\r\n\t\tallData = Object.keys(allData).map(key => allData[key]);\r\n\t\tthis.setState({data: allData});\r\n\t};\r\n    \r\n    doUpdate = async data => {\r\n\t\ttry{\r\n\t\t\tdelete data.__v;\r\n\t\t\tdata.isAdmin = JSON.parse(data.isAdmin);\r\n\t\t\tawait update(data);\r\n\t\t}\r\n\t\tcatch(ex){\r\n\t\t\tif(ex.response && ex.response.status === 400){\r\n\t\t\t\tconsole.log(\"Incorrectly data entered!\");\r\n\t\t\t}\r\n\t\t}\r\n    };\r\n    \r\n    getPageData = () => {\r\n\t\tconst { pageSize, currentPage, data: allData, searchQuery, sortColumn } = this.state;\r\n\r\n        console.log(searchQuery);\r\n\t\tlet filtered = allData;\r\n\t\tif(searchQuery) filtered = allData.filter(m => m.email.toLowerCase().startsWith(searchQuery.toLowerCase()));\r\n\r\n\t\tconst sorted = _.orderBy(filtered, [sortColumn.path], [sortColumn.order]);\r\n\r\n\t\tconst data = paginate(sorted, currentPage, pageSize);\r\n\r\n\t\treturn {totalCount: filtered.length, data: data};\r\n\t};\r\n\r\n    render(){\r\n        if(process.browser && !auth.getCurrentUser()) {\r\n            window.location.replace(\"/login\");\r\n        }\r\n        else {\r\n            const { pageSize, currentPage, searchQuery, sortColumn } = this.state;\r\n            const {totalCount, data} = this.getPageData();\r\n        \r\n            return (\r\n                <Layout>\r\n                    <p>Hello {this.state.user.name}! ADMINNDWIA</p>\r\n                    <div className=\"row\">\r\n                        <div className=\"col-md-3\">\r\n                            <input type=\"text\" onChange={this.handleSearch} placeholder=\"Search Users...\" value={this.state.searchQuery} name=\"searchQueryCryptocurrencies\" className=\"form-control shadow\" style={{display: \"inline-block\"}}/>\r\n                            <span>   <i className=\"fas fa-search\" style={{display: \"inline-block\"}}/></span>\r\n                        </div>\r\n                        <div className=\"col-md-9\">\r\n\t\t\t\t\t\t{!_.isEmpty(this.state.data) ? <div>\r\n\t\t\t\t\t\t\t<DataTable\r\n\t\t\t\t\t\t\t\tdata={data}\r\n\t\t\t\t\t\t\t\tsortColumn={sortColumn}\r\n\t\t\t\t\t\t\t\tonDelete={this.handleDelete}\r\n\t\t\t\t\t\t\t\tonSort={this.handleSort}\r\n\t\t\t\t\t\t\t\tcolumns={this.state.columns}\r\n\t\t\t\t\t\t\t/></div>: <img src={require(\"../src/91.gif\")} alt=\"loading\"/>}\r\n\t\t\t\t\t\t<Pagination\r\n\t\t\t\t\t\t\titemsCount={totalCount}\r\n\t\t\t\t\t\t\tpageSize={pageSize}\r\n\t\t\t\t\t\t\tcurrentPage={currentPage}\r\n\t\t\t\t\t\t\tonPageChange={this.handlePageChange}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n                    </div>\r\n                </Layout>\r\n            );\r\n        }\r\n    }\r\n}"],"mappings":"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","sourceRoot":""}